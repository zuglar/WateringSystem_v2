<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Watering System">
    <script src="resources/jquery-3.6.0.min.js"></script>
    <link rel="icon" type="image/png" href="./icns/garden.png" sizes="24x24">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        .container {
            width: 400px;
            margin: auto;
        }

        p {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <p><span id="message"></span> <span id="count"> </span> <span id="sec"></span></p>
    </div>

    <script>
        window.onload = function () {
            const answer = window.confirm("\t\tINFORMATION !!!\nNew values have been saved.\n" +
                "You have to restart system for new values validation.\n" +
                "Do you want to restart system now?");

            var count = 5;

            if (answer) {
                document.getElementById("message").innerHTML = "The system will restart in";
                document.getElementById("count").innerHTML = count;
                document.getElementById("sec").innerHTML = "seconds.";
            } else {
                document.getElementById("message").innerHTML = "You will be redirected to previous page in";
                document.getElementById("count").innerHTML = count;
                document.getElementById("sec").innerHTML = "seconds.";
            }

            var time = setInterval(function () {
                count--;
                document.getElementById("count").innerHTML = count;
                if (count > 1) {
                    document.getElementById("sec").innerHTML = "seconds.";
                } else {
                    document.getElementById("sec").innerHTML = "second.";
                }

                if (count == 0) {
                    if (answer) {
                        document.getElementById("message").innerHTML = "You can close window now.";
                        document.getElementById("count").innerHTML = "";
                        document.getElementById("sec").innerHTML = "";
                        /* https://www.codegrepper.com/code-examples/javascript/XMLHttpRequest+with+post+and+body */
                        var xhr = new XMLHttpRequest();
                        var params = "restart=1";
                        xhr.open("POST", "/restart", true);
                        /* Send the proper header information along with the request */
                        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                        /* Call a function when the state changes. */
                        xhr.onload = function () {
                            if (xhr.status == 200) {
                                alert(this.responseText);
                            }
                        }
                        xhr.send(params);
                        clearInterval(time);
                    } else {
                        window.location.replace(window.document.referrer);
                    }
                }
            }, 1000);
        }
    </script>
</body>

</html>